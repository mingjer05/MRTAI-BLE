<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MRTAI Robot Controller</title>
    <link rel="stylesheet" href="style.css">
    <!-- Import CryptoJS for MD5 hashing (required by esptool-js) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

    <script>
        window.onerror = function (msg, url, line, col, error) {
            const terminal = document.getElementById('terminal');
            if (terminal) {
                terminal.style.display = 'block';
                terminal.innerText += `\n[Page Error]: ${msg}\nLine: ${line}`;
            }
            alert(`Error: ${msg}\nLine: ${line}`);
        };
    </script>
</head>

<body>
    <div class="container">
        <header class="header">
            <img src="logo.png" alt="MRTAI Logo" class="logo">
            <h1>MRTAI Controller</h1>
            <span id="serverStatus" style="font-size: 0.7em; color: #666; margin-left: 10px;">(Checking
                Server...)</span>
        </header>

        <!-- Connection Status -->
        <div class="status-panel">
            <button id="connectBtn" class="btn primary">Connect Robot (BLE)</button>

        </div>

        <!-- Control Pad -->
        <div class="control-pad">
            <button id="btnForward" class="d-pad-btn up" data-cmd="F">▲</button>
            <button id="btnLeft" class="d-pad-btn left" data-cmd="L">◄</button>
            <button id="btnStop" class="d-pad-btn center" data-cmd="S">◼</button>
            <button id="btnRight" class="d-pad-btn right" data-cmd="R">►</button>
            <button id="btnBackward" class="d-pad-btn down" data-cmd="B">▼</button>
        </div>

        <!-- Speed Control Slider -->
        <div class="speed-control"
            style="margin: 20px 0; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px;">
            <label for="speedSlider" style="display: block; margin-bottom: 10px; font-weight: bold;">Motor Speed: <span
                    id="speedValue">255</span></label>
            <input type="range" id="speedSlider" min="0" max="255" value="255"
                style="width: 100%; accent-color: #4caf50;">
        </div>

        <!-- Build Configuration Panel -->
        <div class="firmware-panel">
            <h2>Build Configuration</h2>
            <div class="build-controls">
                <input type="text" id="bleNameInput" placeholder="Enter BLE Name (e.g. MyRobot)" class="file-input"
                    style="margin-bottom: 15px; background: rgba(255,255,255,0.05); color: white; border: 1px solid rgba(255,255,255,0.1); padding: 12px; border-radius: 8px; width: calc(100% - 24px);">
                <button id="buildBtn" class="btn primary" style="width: 100%;">Generate & Compile Firmware</button>
            </div>
            <div id="buildStatus" style="margin-top: 10px; font-size: 0.9em; color: #aaa;"></div>
        </div>

        <!-- Firmware Upload Section -->
        <div class="firmware-panel">
            <h2>Flash to Robot</h2>
            <div class="upload-controls">
                <input type="file" id="firmwareFile" accept=".bin" class="file-input">
                <button id="flashBtn" class="btn secondary">Flash Firmware (USB)</button>
            </div>
            <div id="terminal" class="terminal" style="display:none;"></div>
        </div>
    </div>
    <script src="esptool-bundle.js"></script>
    <script src="app.js"></script>
</body>

</html>